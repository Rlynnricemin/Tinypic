"use strict";function _instanceof(left,right){if(right!=null&&typeof Symbol!=="undefined"&&right[Symbol.hasInstance]){return !!right[Symbol.hasInstance](left)}else{return left instanceof right}}
/*!
 * Tinycon - A small library for compress the image
 * Lynnricemin, http://tommoor.com
 * Copyright (c) 2019 Lynnricemin
 * @license MIT Licensed
 */
(function(){var defaults={file:null,type:"file",limitsize:100*1024*1024,callback:function callback(file){console.info(file)}};var filetype="image/jpeg";function Tinypic(config){for(var key in defaults){config[key]=config.hasOwnProperty(key)?config[key]:defaults[key]}this.file=config.file;this.type=config.type;this.limitsize=config.limitsize;this.callback=config.callback;if(!checktype(config)){return}getCompressFile.call(this);return this}function checktype(config){var error=0;var file=config.file,type=config.type,limitsize=config.limitsize,callback=config.callback;if(!(_instanceof(file,File)||typeof file==="string"&&["image/jpeg","image/png"].indexOf(file.type))){console.warn("typeof File is incorrect");error=1}if(["file","base64"].indexOf(type)===-1){console.warn("type isnt exits");error=1}filetype=file.type;if(typeof limitsize!=="number"){console.warn("limitsize should be number");error=1}if(typeof callback!=="function"){console.warn("callback should be function");error=1}return error?false:true}function getCompressFile(file,canvassize){var _this=this;file=file?file:this.file;var size=0;var comSize=1;var newimg=new Image();var canvas=document.createElement("canvas");var ctx=canvas.getContext("2d");if(_instanceof(file,File)){size=file.size;if(size<=this.limitsize){comSize=1;if(this.type==="file"){this.callback(file);return}}else{comSize=Math.sqrt(this.limitsize/size)}var _reader=new FileReader();_reader.readAsDataURL(file);_reader.onload=function(){newimg.src=_reader.result}}else{comSize=Math.sqrt(this.limitsize/canvassize);newimg.src=file.toDataURL(filetype)}newimg.onload=function(){canvas.width=newimg.naturalWidth*comSize;canvas.height=newimg.naturalHeight*comSize;ctx.drawImage(newimg,0,0,newimg.naturalWidth*comSize,newimg.naturalHeight*comSize);var mindata=canvas.toDataURL(filetype);var resultdatamore=coverBase64ToBlob.call(_this,mindata.replace("data:"+filetype+";base64,",""));if(!resultdatamore.result){getCompressFile.call(_this,canvas,resultdatamore.data)}else{var resdata=_this.type==="file"?resultdatamore.data:resultdatamore.base64;_this.callback(resdata)}}}function coverBase64ToBlob(base64string){var imagedata=window.atob(base64string);var _ia=new Uint8Array(imagedata.length);for(var i=0;i<imagedata.length;i++){_ia[i]=imagedata.charCodeAt(i)}if(_ia.length<this.limitsize){return{"result":true,"data":new File([_ia],this.file.name,{type:filetype}),"base64":"data:"+filetype+";base64,"+base64string}}else{return{"result":false,"data":_ia.length}}}if(typeof module!=="undefined"){module.exports=Tinypic}else{window.Tinypic=Tinypic}})();